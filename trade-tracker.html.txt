<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商贸统计器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #333;
            --text-light: #777;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), #1a2530);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-content h1 {
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-content h1 i {
            color: var(--secondary-color);
        }
        
        .header-content p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .stats {
            display: flex;
            gap: 25px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .card-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .card-title i {
            color: var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        input, select, .status-light {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .status-lights {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .status-light {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .status-light:hover {
            transform: translateY(-2px);
        }
        
        .yellow-light {
            background-color: #fef9e7;
            color: #b7950b;
            border: 2px solid #f7dc6f;
        }
        
        .blue-light {
            background-color: #eaf2f8;
            color: #2874a6;
            border: 2px solid #3498db;
        }
        
        .green-light {
            background-color: #eafaf1;
            color: #196f3d;
            border: 2px solid #58d68d;
        }
        
        .status-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .status-path {
            margin-top: 15px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 8px;
            border: 1px dashed var(--secondary-color);
        }
        
        .status-path-title {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-path-desc {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        
        .status-sequence {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .status-item {
            padding: 6px 12px;
            background-color: white;
            border-radius: 6px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .status-arrow {
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #ecf0f1;
            color: var(--primary-color);
        }
        
        .btn-secondary:hover {
            background-color: #d5dbdb;
        }
        
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .search-input {
            flex: 1;
            padding: 14px 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
        }
        
        .search-btn {
            padding: 0 25px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .search-btn:hover {
            background-color: #1a252f;
        }
        
        .orders-list {
            max-height: 700px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .order-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--secondary-color);
            transition: transform 0.3s;
        }
        
        .order-item:hover {
            transform: translateY(-3px);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .order-category {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .category-shoe {
            background-color: #fdebd0;
            color: #e67e22;
        }
        
        .category-clothing {
            background-color: #d6eaf8;
            color: #2980b9;
        }
        
        .category-electronics {
            background-color: #d5f4e6;
            color: #27ae60;
        }
        
        .category-beauty {
            background-color: #fadbd8;
            color: #e74c3c;
        }
        
        .category-other {
            background-color: #e8daef;
            color: #8e44ad;
        }
        
        .order-date {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed var(--border-color);
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--text-light);
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .order-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .order-lights {
            display: flex;
            gap: 10px;
        }
        
        .order-light {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }
        
        .light-yellow {
            background-color: #f7dc6f;
        }
        
        .light-blue {
            background-color: #3498db;
        }
        
        .light-green {
            background-color: #58d68d;
        }
        
        .order-financial {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .financial-pending {
            background-color: #fef9e7;
            color: #b7950b;
        }
        
        .financial-completed {
            background-color: #eafaf1;
            color: #196f3d;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .edit-btn {
            background-color: #e8f4fc;
            color: var(--secondary-color);
        }
        
        .edit-btn:hover {
            background-color: #d6eaf8;
        }
        
        .delete-btn {
            background-color: #fdedec;
            color: var(--danger-color);
        }
        
        .delete-btn:hover {
            background-color: #fadbd8;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #bdc3c7;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 14px;
        }
        
        .financial-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background-color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .filter-btn:hover:not(.active) {
            background-color: var(--light-bg);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1><i class="fas fa-calculator"></i> 商贸统计器</h1>
            <p>管理您的商贸订单，跟踪物流、货物和钱款状态</p>
        </div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-orders">0</div>
                <div class="stat-label">总订单</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="pending-financial">0</div>
                <div class="stat-label">待结算</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="completed-orders">0</div>
                <div class="stat-label">已完成</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="left-column">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-plus-circle"></i> 添加/编辑订单</h2>
                
                <div class="form-group">
                    <label for="order-date">日期</label>
                    <input type="date" id="order-date">
                </div>
                
                <div class="form-group">
                    <label for="order-category">类别</label>
                    <select id="order-category">
                        <option value="shoe">鞋</option>
                        <option value="clothing">衣服/裤子</option>
                        <option value="electronics">电子</option>
                        <option value="beauty">美妆</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="unit-price">拿货价 (元/件)</label>
                    <input type="number" id="unit-price" step="0.001" min="0" placeholder="0.000">
                </div>
                
                <div class="form-group">
                    <label for="quantity">件数</label>
                    <input type="number" id="quantity" min="1" value="1">
                </div>
                
                <div class="form-group">
                    <label>总拿货价 (元)</label>
                    <input type="text" id="total-price" readonly>
                </div>
                
                <div class="form-group">
                    <label>状态指示灯</label>
                    <div class="status-lights">
                        <select id="logistics-status" class="status-light yellow-light">
                            <option value="yellow">黄 - 未完成</option>
                            <option value="blue">蓝 - 处理中</option>
                            <option value="green">绿 - 已完成</option>
                        </select>
                        <select id="goods-status" class="status-light yellow-light">
                            <option value="yellow">黄 - 有问题</option>
                            <option value="blue">蓝 - 检验中</option>
                            <option value="green">绿 - 无问题</option>
                        </select>
                        <select id="money-status" class="status-light yellow-light">
                            <option value="yellow">黄 - 未结算</option>
                            <option value="blue">蓝 - 处理中</option>
                            <option value="green">绿 - 已结算</option>
                        </select>
                    </div>
                    <div class="status-info">
                        当前状态: <span id="current-status-text">下单后，待发货</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="financial-status">财务结算状态</label>
                    <select id="financial-status">
                        <option value="pending">待财务结算</option>
                        <option value="completed">已结算</option>
                    </select>
                </div>
                
                <div id="status-path-container" class="status-path">
                    <div class="status-path-title">
                        <i class="fas fa-route"></i> 状态路径: 路径1 - 正常无瑕疵，直接卖出
                    </div>
                    <div class="status-path-desc">
                        业务场景：电商拿货无问题，发往某物后检验通过并卖出结算
                    </div>
                    <div class="status-sequence">
                        <span class="status-item yellow-light">S1</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item blue-light">S4</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item green-light">S6</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item green-light">S11</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item blue-light">S4</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item green-light">S8</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item green-light">S11</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item green-light">S12</span>
                        <span class="status-arrow">→</span>
                        <span class="status-item green-light">S13</span>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="save-btn" class="btn btn-primary">
                        <i class="fas fa-save"></i> 保存订单
                    </button>
                    <button id="reset-btn" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> 重置表单
                    </button>
                </div>
                
                <input type="hidden" id="edit-id">
            </div>
        </div>
        
        <div class="right-column">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-list"></i> 订单列表</h2>
                
                <div class="search-bar">
                    <input type="text" id="search-input" class="search-input" placeholder="搜索订单 (类别、状态、日期...)">
                    <button id="search-btn" class="search-btn">
                        <i class="fas fa-search"></i> 搜索
                    </button>
                </div>
                
                <div class="financial-filter">
                    <button class="filter-btn active" data-filter="all">全部订单</button>
                    <button class="filter-btn" data-filter="pending">待结算</button>
                    <button class="filter-btn" data-filter="completed">已结算</button>
                </div>
                
                <div class="orders-list" id="orders-list">
                    <!-- 订单列表将通过JavaScript动态生成 -->
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>暂无订单</h3>
                        <p>点击左侧表单添加您的第一个订单</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>商贸统计器 v1.0 | 数据存储于浏览器本地存储中 | 订单将在结算15天后自动删除</p>
    </div>

    <script>
        // 状态定义和路径映射
        const statusDefinitions = {
            "yellow-yellow-yellow": { code: "S1", text: "下单后，待发货" },
            "yellow-yellow-green": { code: "S3", text: "未发货退款完成（订单结束）" },
            "blue-yellow-yellow": { code: "S4", text: "运输中，瑕疵未知" },
            "blue-yellow-blue": { code: "S5", text: "运输中，退款/拦截处理中" },
            "green-yellow-yellow": { code: "S6", text: "货到手，重度瑕疵" },
            "green-yellow-blue": { code: "S7", text: "重度瑕疵，退款中" },
            "green-blue-yellow": { code: "S8", text: "货到手，检验中/轻度瑕疵" },
            "green-blue-blue": { code: "S9", text: "轻度瑕疵，退款/协商中" },
            "green-blue-green": { code: "S10", text: "轻度瑕疵，钱款已结（售后阶段）" },
            "green-green-yellow": { code: "S11", text: "检验通过，待收款" },
            "green-green-blue": { code: "S12", text: "检验通过，结算中" },
            "green-green-green": { code: "S13", text: "交易完全结束" }
        };

        // 路径定义
        const statusPaths = {
            "path1": {
                title: "路径1 - 正常无瑕疵，直接卖出",
                description: "业务场景：电商拿货无问题，发往某物后检验通过并卖出结算",
                sequence: ["S1", "S4", "S6", "S11", "S4", "S8", "S11", "S12", "S13"]
            },
            "path2": {
                title: "路径2 - 有重度瑕疵，直接退货退款",
                description: "业务场景：你收到货发现重度瑕疵，直接退回电商商家",
                sequence: ["S6", "S7", "S3"]
            },
            "path3": {
                title: "路径3 - 某物检验有轻度瑕疵，协商降价成功",
                description: "业务场景：某物检验发现轻微瑕疵，与买家协商降价后成交",
                sequence: ["S8", "S10", "S12", "S13"]
            },
            "path4A": {
                title: "路径4A - 某物检验轻度瑕疵，协商降价失败（放95分平台）",
                description: "业务场景：买家不同意降价，你选择放95分平台",
                sequence: ["S8", "S11", "S12", "S13"]
            },
            "path4B": {
                title: "路径4B - 某物检验轻度瑕疵，协商降价失败（退回修复后重发）",
                description: "业务场景：买家不同意降价，退回给你，你修复后重发某物",
                sequence: ["S8", "S4", "S6", "S11", "S4", "S8"]
            },
            "path4C": {
                title: "路径4C - 某物检验轻度瑕疵，协商降价失败（直接退回商家）",
                description: "业务场景：买家不同意降价，直接退回电商商家",
                sequence: ["S8", "S4", "S6", "S7", "S3"]
            },
            "path5": {
                title: "路径5 - 未发货砍单或自主取消",
                description: "业务场景：下单后未发货即取消，秒退款",
                sequence: ["S1", "S3"]
            },
            "path6A": {
                title: "路径6A - 已发货后利润波动，主动拦截成功",
                description: "业务场景：运输中你发现利润下降，申请退款并拦截成功",
                sequence: ["S4", "S5", "S7", "S3"]
            },
            "path6B": {
                title: "路径6B - 已发货后利润波动，拦截失败签收后退货",
                description: "业务场景：运输中你发现利润下降，拦截失败，签收后退货",
                sequence: ["S4", "S5", "S6", "S7", "S3"]
            },
            "path6C": {
                title: "路径6C - 已发货后利润波动，拦截失败直接拒收",
                description: "业务场景：运输中你发现利润下降，拦截失败，直接拒收",
                sequence: ["S4", "S5", "S7", "S3"]
            },
            "path7A": {
                title: "路径7A - 某物检验重度瑕疵，退回到你手",
                description: "业务场景：某物检验判定为重度瑕疵，无协商直接退回你手",
                sequence: ["S8", "S6"]
            },
            "path7B": {
                title: "路径7B - 某物检验重度瑕疵，直接退回电商商家",
                description: "业务场景：某物检验判定为重度瑕疵，直接退回电商商家",
                sequence: ["S8", "S4", "S6", "S7", "S3"]
            },
            "path8": {
                title: "路径8 - 轻度瑕疵售后补偿完成",
                description: "业务场景：确认收货后，因轻度瑕疵获得补偿，订单完结",
                sequence: ["S8", "S10", "S13"]
            },
            "path9": {
                title: "路径9 - 检验通过后申请价保/仅退款",
                description: "业务场景：货已确认无瑕疵，但申请价格保护或部分退款",
                sequence: ["S11", "S12", "S13"]
            }
        };

        // 状态到路径的映射
        const statusToPathMap = {
            "S1": ["path1", "path5"],
            "S3": ["path2", "path4C", "path5", "path6A", "path6B", "path6C", "path7B"],
            "S4": ["path1", "path4B", "path4C", "path6A", "path6B", "path6C", "path7B"],
            "S5": ["path6A", "path6B", "path6C"],
            "S6": ["path1", "path2", "path4B", "path4C", "path6B", "path7A", "path7B"],
            "S7": ["path2", "path4C", "path6A", "path6B", "path6C", "path7B"],
            "S8": ["path1", "path3", "path4A", "path4B", "path4C", "path7A", "path7B", "path8"],
            "S9": [],
            "S10": ["path3", "path8"],
            "S11": ["path1", "path4A", "path4B", "path9"],
            "S12": ["path1", "path3", "path4A", "path9"],
            "S13": ["path1", "path3", "path4A", "path8", "path9"]
        };

        // 从本地存储获取订单数据
        function getOrders() {
            const ordersJson = localStorage.getItem('tradeOrders');
            return ordersJson ? JSON.parse(ordersJson) : [];
        }

        // 保存订单到本地存储
        function saveOrders(orders) {
            localStorage.setItem('tradeOrders', JSON.stringify(orders));
        }

        // 计算总拿货价
        function calculateTotalPrice() {
            const unitPrice = parseFloat(document.getElementById('unit-price').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const totalPrice = (unitPrice * quantity).toFixed(2);
            document.getElementById('total-price').value = totalPrice;
            return totalPrice;
        }

        // 更新状态显示
        function updateStatusDisplay() {
            const logisticsStatus = document.getElementById('logistics-status').value;
            const goodsStatus = document.getElementById('goods-status').value;
            const moneyStatus = document.getElementById('money-status').value;
            
            const statusKey = `${logisticsStatus}-${goodsStatus}-${moneyStatus}`;
            const statusInfo = statusDefinitions[statusKey];
            
            if (statusInfo) {
                document.getElementById('current-status-text').textContent = statusInfo.text;
                
                // 更新状态路径显示
                updateStatusPath(statusInfo.code, statusKey);
            }
        }

        // 更新状态路径显示
        function updateStatusPath(statusCode, statusKey) {
            const pathContainer = document.getElementById('status-path-container');
            const possiblePaths = statusToPathMap[statusCode] || [];
            
            if (possiblePaths.length > 0) {
                const path = statusPaths[possiblePaths[0]];
                
                // 更新路径标题和描述
                const titleElement = pathContainer.querySelector('.status-path-title');
                const descElement = pathContainer.querySelector('.status-path-desc');
                const sequenceElement = pathContainer.querySelector('.status-sequence');
                
                titleElement.innerHTML = `<i class="fas fa-route"></i> ${path.title}`;
                descElement.textContent = path.description;
                
                // 更新序列
                sequenceElement.innerHTML = '';
                path.sequence.forEach((code, index) => {
                    const statusItem = document.createElement('span');
                    statusItem.className = 'status-item';
                    
                    // 根据状态代码确定颜色
                    const statusDef = Object.values(statusDefinitions).find(def => def.code === code);
                    let statusColor = 'yellow-light';
                    if (statusDef) {
                        const statusKey = Object.keys(statusDefinitions).find(key => statusDefinitions[key].code === code);
                        if (statusKey.includes('green-green')) {
                            statusColor = 'green-light';
                        } else if (statusKey.includes('blue')) {
                            statusColor = 'blue-light';
                        }
                    }
                    
                    statusItem.className = `status-item ${statusColor}`;
                    statusItem.textContent = code;
                    sequenceElement.appendChild(statusItem);
                    
                    // 如果不是最后一个，添加箭头
                    if (index < path.sequence.length - 1) {
                        const arrow = document.createElement('span');
                        arrow.className = 'status-arrow';
                        arrow.textContent = '→';
                        sequenceElement.appendChild(arrow);
                    }
                });
                
                pathContainer.style.display = 'block';
            } else {
                pathContainer.style.display = 'none';
            }
        }

        // 重置表单
        function resetForm() {
            document.getElementById('order-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('order-category').value = 'shoe';
            document.getElementById('unit-price').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('total-price').value = '';
            document.getElementById('logistics-status').value = 'yellow';
            document.getElementById('goods-status').value = 'yellow';
            document.getElementById('money-status').value = 'yellow';
            document.getElementById('financial-status').value = 'pending';
            document.getElementById('edit-id').value = '';
            
            // 更新状态显示
            updateStatusDisplay();
            
            // 更新按钮文本
            document.getElementById('save-btn').innerHTML = '<i class="fas fa-save"></i> 保存订单';
        }

        // 保存订单
        function saveOrder() {
            const editId = document.getElementById('edit-id').value;
            const date = document.getElementById('order-date').value;
            const category = document.getElementById('order-category').value;
            const unitPrice = parseFloat(document.getElementById('unit-price').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const totalPrice = calculateTotalPrice();
            const logisticsStatus = document.getElementById('logistics-status').value;
            const goodsStatus = document.getElementById('goods-status').value;
            const moneyStatus = document.getElementById('money-status').value;
            const financialStatus = document.getElementById('financial-status').value;
            
            // 验证必填字段
            if (!date || unitPrice <= 0) {
                alert('请填写完整的订单信息！');
                return;
            }
            
            const statusKey = `${logisticsStatus}-${goodsStatus}-${moneyStatus}`;
            const statusInfo = statusDefinitions[statusKey];
            
            const order = {
                id: editId || Date.now().toString(),
                date,
                category,
                unitPrice,
                quantity,
                totalPrice,
                logisticsStatus,
                goodsStatus,
                moneyStatus,
                statusCode: statusInfo ? statusInfo.code : 'S1',
                statusText: statusInfo ? statusInfo.text : '未知状态',
                financialStatus,
                createdAt: editId ? undefined : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            let orders = getOrders();
            
            if (editId) {
                // 编辑现有订单
                const index = orders.findIndex(o => o.id === editId);
                if (index !== -1) {
                    order.createdAt = orders[index].createdAt;
                    orders[index] = order;
                }
            } else {
                // 添加新订单
                orders.push(order);
            }
            
            saveOrders(orders);
            resetForm();
            renderOrders();
            updateStats();
        }

        // 编辑订单
        function editOrder(id) {
            const orders = getOrders();
            const order = orders.find(o => o.id === id);
            
            if (order) {
                document.getElementById('order-date').value = order.date;
                document.getElementById('order-category').value = order.category;
                document.getElementById('unit-price').value = order.unitPrice;
                document.getElementById('quantity').value = order.quantity;
                document.getElementById('logistics-status').value = order.logisticsStatus;
                document.getElementById('goods-status').value = order.goodsStatus;
                document.getElementById('money-status').value = order.moneyStatus;
                document.getElementById('financial-status').value = order.financialStatus;
                document.getElementById('edit-id').value = order.id;
                
                // 更新总价和状态显示
                calculateTotalPrice();
                updateStatusDisplay();
                
                // 更新按钮文本
                document.getElementById('save-btn').innerHTML = '<i class="fas fa-save"></i> 更新订单';
                
                // 滚动到表单
                document.querySelector('.left-column').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // 删除订单
        function deleteOrder(id) {
            if (confirm('确定要删除这个订单吗？')) {
                let orders = getOrders();
                orders = orders.filter(o => o.id !== id);
                saveOrders(orders);
                renderOrders();
                updateStats();
                
                // 如果正在编辑此订单，重置表单
                if (document.getElementById('edit-id').value === id) {
                    resetForm();
                }
            }
        }

        // 获取类别显示文本
        function getCategoryText(category) {
            const categoryMap = {
                'shoe': '鞋',
                'clothing': '衣服/裤子',
                'electronics': '电子',
                'beauty': '美妆',
                'other': '其他'
            };
            return categoryMap[category] || category;
        }

        // 获取类别CSS类
        function getCategoryClass(category) {
            const classMap = {
                'shoe': 'category-shoe',
                'clothing': 'category-clothing',
                'electronics': 'category-electronics',
                'beauty': 'category-beauty',
                'other': 'category-other'
            };
            return classMap[category] || 'category-other';
        }

        // 获取状态指示灯颜色类
        function getLightClass(status) {
            const classMap = {
                'yellow': 'light-yellow',
                'blue': 'light-blue',
                'green': 'light-green'
            };
            return classMap[status] || 'light-yellow';
        }

        // 渲染订单列表
        function renderOrders(filter = 'all', searchTerm = '') {
            const orders = getOrders();
            const ordersList = document.getElementById('orders-list');
            
            // 过滤和排序订单
            let filteredOrders = orders;
            
            // 应用搜索过滤
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredOrders = filteredOrders.filter(order => {
                    return (
                        getCategoryText(order.category).toLowerCase().includes(term) ||
                        order.statusText.toLowerCase().includes(term) ||
                        order.date.includes(term) ||
                        order.statusCode.toLowerCase().includes(term)
                    );
                });
            }
            
            // 应用财务状态过滤
            if (filter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.financialStatus === filter);
            }
            
            // 排序：待结算的订单置顶，然后按创建时间倒序
            filteredOrders.sort((a, b) => {
                // 待结算订单优先
                if (a.financialStatus === 'pending' && b.financialStatus !== 'pending') return -1;
                if (a.financialStatus !== 'pending' && b.financialStatus === 'pending') return 1;
                
                // 然后按创建时间倒序
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            if (filteredOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>暂无订单</h3>
                        <p>${searchTerm ? '没有找到匹配的订单' : '点击左侧表单添加您的第一个订单'}</p>
                    </div>
                `;
                return;
            }
            
            ordersList.innerHTML = '';
            
            filteredOrders.forEach(order => {
                const orderElement = document.createElement('div');
                orderElement.className = 'order-item';
                
                // 检查订单是否已结算超过15天
                let shouldDelete = false;
                if (order.financialStatus === 'completed' && order.updatedAt) {
                    const updatedDate = new Date(order.updatedAt);
                    const now = new Date();
                    const daysDiff = Math.floor((now - updatedDate) / (1000 * 60 * 60 * 24));
                    if (daysDiff > 15) {
                        shouldDelete = true;
                    }
                }
                
                // 如果应该删除，跳过渲染并从存储中删除
                if (shouldDelete) {
                    let orders = getOrders();
                    orders = orders.filter(o => o.id !== order.id);
                    saveOrders(orders);
                    return; // 跳过这个订单的渲染
                }
                
                const categoryText = getCategoryText(order.category);
                const categoryClass = getCategoryClass(order.category);
                const logisticsLightClass = getLightClass(order.logisticsStatus);
                const goodsLightClass = getLightClass(order.goodsStatus);
                const moneyLightClass = getLightClass(order.moneyStatus);
                
                const financialStatusText = order.financialStatus === 'pending' ? '待财务结算' : '已结算';
                const financialStatusClass = order.financialStatus === 'pending' ? 'financial-pending' : 'financial-completed';
                
                orderElement.innerHTML = `
                    <div class="order-header">
                        <span class="order-category ${categoryClass}">${categoryText}</span>
                        <span class="order-date">${order.date}</span>
                    </div>
                    <div class="order-details">
                        <div class="detail-item">
                            <span class="detail-label">拿货价:</span>
                            <span class="detail-value">${order.unitPrice.toFixed(3)} 元/件</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">件数:</span>
                            <span class="detail-value">${order.quantity} 件</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">总拿货价:</span>
                            <span class="detail-value">${order.totalPrice} 元</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">状态:</span>
                            <span class="detail-value">${order.statusCode} - ${order.statusText}</span>
                        </div>
                    </div>
                    <div class="order-status">
                        <div class="order-lights">
                            <div class="order-light ${logisticsLightClass}" title="物流状态"></div>
                            <div class="order-light ${goodsLightClass}" title="货物状态"></div>
                            <div class="order-light ${moneyLightClass}" title="钱款状态"></div>
                        </div>
                        <div class="order-financial ${financialStatusClass}">${financialStatusText}</div>
                    </div>
                    <div class="order-actions">
                        <button class="action-btn edit-btn" onclick="editOrder('${order.id}')">
                            <i class="fas fa-edit"></i> 编辑
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteOrder('${order.id}')">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                    </div>
                `;
                
                ordersList.appendChild(orderElement);
            });
        }

        // 更新统计信息
        function updateStats() {
            const orders = getOrders();
            const totalOrders = orders.length;
            const pendingFinancial = orders.filter(o => o.financialStatus === 'pending').length;
            const completedOrders = orders.filter(o => o.financialStatus === 'completed').length;
            
            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('pending-financial').textContent = pendingFinancial;
            document.getElementById('completed-orders').textContent = completedOrders;
        }

        // 初始化
        function init() {
            // 设置当前日期为默认日期
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('order-date').value = today;
            
            // 绑定事件监听器
            document.getElementById('unit-price').addEventListener('input', calculateTotalPrice);
            document.getElementById('quantity').addEventListener('input', calculateTotalPrice);
            document.getElementById('logistics-status').addEventListener('change', updateStatusDisplay);
            document.getElementById('goods-status').addEventListener('change', updateStatusDisplay);
            document.getElementById('money-status').addEventListener('change', updateStatusDisplay);
            document.getElementById('save-btn').addEventListener('click', saveOrder);
            document.getElementById('reset-btn').addEventListener('click', resetForm);
            document.getElementById('search-btn').addEventListener('click', performSearch);
            document.getElementById('search-input').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });
            
            // 绑定筛选按钮
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.getAttribute('data-filter');
                    const searchTerm = document.getElementById('search-input').value;
                    renderOrders(filter, searchTerm);
                });
            });
            
            // 初始渲染
            updateStatusDisplay();
            renderOrders();
            updateStats();
        }

        // 执行搜索
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value;
            const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-filter');
            renderOrders(activeFilter, searchTerm);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>